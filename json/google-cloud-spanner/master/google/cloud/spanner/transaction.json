{"id":"google/cloud/spanner/transaction","name":"Transaction","title":["Google","Cloud","Spanner","Transaction"],"description":"<h1 id=\"transaction\">Transaction</h1>\n\n<p>A transaction in Cloud Spanner is a set of reads and writes that execute\natomically at a single logical point in time across columns, rows, and\ntables in a database.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L44","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  results = tx.execute \"SELECT * FROM users\"\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\"\n  end\nend"}],"methods":[{"id":"execute-instance","type":"instance","name":"execute","title":["Google","Cloud","Spanner","Transaction#execute"],"description":"<p>Executes a SQL query.</p>\n\n<p>Arguments can be passed using <code>params</code>, Ruby types are mapped to\nSpanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>\n\n<p>See <a href=\"https://cloud.google.com/spanner/docs/data-definition-language#data_types\">Data\ntypes</a>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L111","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  results = tx.execute \"SELECT * FROM users\"\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\"\n  end\nend"},{"caption":"<p>Query using query parameters:</p>","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  results = tx.execute \"SELECT * FROM users WHERE active = @active\",\n                       params: { active: true }\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\"\n  end\nend"}],"params":[{"name":"sql","types":["String"],"description":"The SQL query string. See <a href=\"https://cloud.google.com/spanner/docs/query-syntax\">Query\nsyntax</a>.</p>\n\n<p>The SQL query string can contain parameter placeholders. A parameter\nplaceholder consists of “@” followed by the parameter name.\nParameter names consist of any combination of letters, numbers, and\nunderscores.","optional":false,"nullable":false},{"name":"params","types":["Hash"],"description":"SQL parameters for the query string. The\nparameter placeholders, minus the “@”, are the the hash keys, and\nthe literal values are the hash values. If the query string contains\nsomething like “WHERE id &gt; @msg_id”, then the params must contain\nsomething like <code>:msg_id -&gt; 1</code>.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/results\">Google::Cloud::Spanner::Results</a>"],"description":""}]},{"id":"read-instance","type":"instance","name":"read","title":["Google","Cloud","Spanner","Transaction#read"],"description":"<p>Read rows from a database table, as a simple alternative to\n<a data-custom-type=\"google/cloud/spanner/transaction\" data-method=\"execute-instance\">#execute</a>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L150","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  results = tx.read \"users\", [\"id, \"name\"]\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\"\n  end\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nread.","optional":false,"nullable":false},{"name":"columns","types":["Array<String>"],"description":"The columns of table to be returned for\neach row matching this request.","optional":false,"nullable":false},{"name":"keys","types":["Object","Array<Object>"],"description":"A single, or list of keys or key\nranges to match returned data to. Values should have exactly as many\nelements as there are columns in the primary key.","optional":true,"default":"nil","nullable":true},{"name":"index","types":["String"],"description":"The name of an index to use instead of the\ntable’s primary key when interpreting <code>id</code> and sorting result rows.\nOptional.","optional":true,"default":"nil","nullable":true},{"name":"limit","types":["Integer"],"description":"If greater than zero, no more than this number\nof rows will be returned. The default is no limit.","optional":true,"default":"nil","nullable":true}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/results\">Google::Cloud::Spanner::Results</a>"],"description":""}]},{"id":"commit-instance","type":"instance","name":"commit","title":["Google","Cloud","Spanner","Transaction#commit"],"description":"<p>Creates changes to be applied to rows in the database.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L174","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.commit do |c|\n    c.update \"users\", [{ id: 1, name: \"Charlie\", active: false }]\n    c.insert \"users\", [{ id: 2, name: \"Harvey\",  active: true }]\n  end\nend"}],"params":[{"name":"yield","types":["block"],"description":"The block for updating the data.","optional":true,"nullable":false},{"name":"yield.commit","types":["Google::Cloud::Spanner::Commit"],"description":"The Commit object.","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"upsert-instance","type":"instance","name":"upsert","title":["Google","Cloud","Spanner","Transaction#upsert"],"description":"<p>Inserts or updates rows in a table. If any of the rows already exist,\nthen its column values are overwritten with the ones provided. Any\ncolumn values not explicitly written are preserved.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L216","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.upsert \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                      { id: 2, name: \"Harvey\",  active: true }]\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"rows","types":["Array<Hash>"],"description":"One or more hash objects with the hash keys\nmatching the table’s columns, and the hash values matching the\ntable’s values.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"insert-instance","type":"instance","name":"insert","title":["Google","Cloud","Spanner","Transaction#insert"],"description":"<p>Inserts new rows in a table. If any of the rows already exist, the\nwrite or request fails with error <code>ALREADY_EXISTS</code>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L256","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.insert \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                      { id: 2, name: \"Harvey\",  active: true }]\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"rows","types":["Array<Hash>"],"description":"One or more hash objects with the hash keys\nmatching the table’s columns, and the hash values matching the\ntable’s values.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"update-instance","type":"instance","name":"update","title":["Google","Cloud","Spanner","Transaction#update"],"description":"<p>Updates existing rows in a table. If any of the rows does not already\nexist, the request fails with error <code>NOT_FOUND</code>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L295","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.update \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                      { id: 2, name: \"Harvey\",  active: true }]\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"rows","types":["Array<Hash>"],"description":"One or more hash objects with the hash keys\nmatching the table’s columns, and the hash values matching the\ntable’s values.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"replace-instance","type":"instance","name":"replace","title":["Google","Cloud","Spanner","Transaction#replace"],"description":"<p>Inserts or replaces rows in a table. If any of the rows already exist,\nit is deleted, and the column values provided are inserted instead.\nUnlike #upsert, this means any values not explicitly written become\n<code>NULL</code>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L336","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  tx.replace \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                       { id: 2, name: \"Harvey\",  active: true }]\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"rows","types":["Array<Hash>"],"description":"One or more hash objects with the hash keys\nmatching the table’s columns, and the hash values matching the\ntable’s values.</p>\n\n<p>Ruby types are mapped to Spanner types as follows:</p>\n\n<table class=\"table\">\n  <thead>\n    <tr>\n      <th>Spanner</th>\n      <th>Ruby</th>\n      <th>Notes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td><code>BOOL</code></td>\n      <td><code>true</code>/<code>false</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>INT64</code></td>\n      <td><code>Integer</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>FLOAT64</code></td>\n      <td><code>Float</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>STRING</code></td>\n      <td><code>String</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>DATE</code></td>\n      <td><code>Date</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>TIMESTAMP</code></td>\n      <td><code>Time</code>, <code>DateTime</code></td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>BYTES</code></td>\n      <td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>\n      <td> </td>\n    </tr>\n    <tr>\n      <td><code>ARRAY</code></td>\n      <td><code>Array</code></td>\n      <td>Nested arrays are not supported.</td>\n    </tr>\n  </tbody>\n</table>","optional":false,"nullable":false}],"exceptions":[],"returns":[]},{"id":"delete-instance","type":"instance","name":"delete","title":["Google","Cloud","Spanner","Transaction#delete"],"description":"<p>Deletes rows from a table. Succeeds whether or not the specified rows\nwere present.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L359","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction { |tx| tx.delete \"users\", [1, 2, 3] }"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to be\nmodified.","optional":false,"nullable":false},{"name":"keys","types":["Object","Array<Object>"],"description":"A single, or list of keys or key\nranges to match returned data to. Values should have exactly as many\nelements as there are columns in the primary key.","optional":true,"default":"[]","nullable":false}],"exceptions":[],"returns":[]},{"id":"types_for-instance","type":"instance","name":"types_for","title":["Google","Cloud","Spanner","Transaction#types_for"],"description":"<p>Indicates the field names and types for a table.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L389","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  users_types = rx.types_for \"users\"\n  tx.insert \"users\", [{ id: 1, name: \"Charlie\", active: false },\n                      { id: 2, name: \"Harvey\",  active: true }],\n            types: users_types\nend"}],"params":[{"name":"table","types":["String"],"description":"The name of the table in the database to\nretrieve types for","optional":false,"nullable":false},{"name":"pairs","types":["Boolean"],"description":"Allow the types to be represented as a nested\nArray of pairs rather than a Hash. This is useful when results have\nduplicate names. The default is <code>false</code>.","optional":true,"default":"false","nullable":false}],"exceptions":[],"returns":[{"types":["Hash","Array"],"description":"The types of the returned data. The default is a\nHash. Is a nested Array of Arrays when <code>pairs</code> is specified."}]},{"id":"range-instance","type":"instance","name":"range","title":["Google","Cloud","Spanner","Transaction#range"],"description":"<p>Creates a Spanner Range. This can be used in place of a Ruby Range\nwhen needing to excluse the beginning value.</p>\n\n<p>beginning value. Default is <code>false</code>.\nending value. Default is <code>false</code>.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L422","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction do |tx|\n  key_range = tx.range 1, 100\n  results = tx.read \"users\", [\"id, \"name\"], keys: key_range\n\n  results.rows.each do |row|\n    puts \"User #{row[:id]} is #{row[:name]}\"\"\n  end\nend"}],"params":[{"name":"beginning","types":["Object"],"description":"The object that defines the beginning of the\nrange.","optional":false,"nullable":false},{"name":"ending","types":["Object"],"description":"The object that defines the end of the range.","optional":false,"nullable":false},{"name":"exclude_begin","types":["Boolean"],"description":"Determines if the range excludes its","optional":true,"default":"false","nullable":false},{"name":"exclude_end","types":["Boolean"],"description":"Determines if the range excludes its","optional":true,"default":"false","nullable":false}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"google/cloud/spanner/range\">Google::Cloud::Spanner::Range</a>"],"description":""}]},{"id":"rollback-instance","type":"instance","name":"rollback","title":["Google","Cloud","Spanner","Transaction#rollback"],"description":"<p>Rolls back the transaction, releasing any locks it holds. It is a good\nidea to call this for any transaction that includes one or more <code>read</code>\nor <code>execute</code> requests and ultimately decides not to commit.</p>","source":"google-cloud-spanner/lib/google/cloud/spanner/transaction.rb#L441","resources":[],"examples":[{"caption":"","code":"require \"google/cloud/spanner\"\n\nspanner = Google::Cloud::Spanner.new\ndb = spanner.client \"my-instance\", \"my-database\"\n\ndb.transaction { |tx| tx.rollback }"}],"params":[],"exceptions":[],"returns":[]}]}