<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <title>Google::Cloud::Storage &mdash; Gcloud Documentation</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="//googlecloudplatform.github.io/gcloud-ruby/css/normalize.css">
    <link rel="stylesheet" href="//googlecloudplatform.github.io/gcloud-ruby/css/main.css">
    <script src="//googlecloudplatform.github.io/gcloud-ruby/js/vendor/modernizr-2.6.2.min.js"></script>
    <link href='//fonts.googleapis.com/css?family=Droid+Sans+Mono|Roboto:300,400,700,700italic,400italic|Open+Sans:300' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" href="https://cloud.google.com/images/gcp-favicon.ico">
  </head>

  <body class="lang-page">
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <header class="page-header fixed" role="banner">
      <h1 class="logo">
        <a href="//googlecloudplatform.github.io/gcloud-ruby/" title="back to home">
          <img src="//googlecloudplatform.github.io/gcloud-ruby/img/logo.svg" alt="Google Cloud Platform">
          <span class="gcloud">gcloud</span>
        </a>
      </h1>

      <nav class="main-nav">
        <div class="nav-current">Ruby</div>
        <ul class="menu">
          <li>
            <a href="//googlecloudplatform.github.io/gcloud-java/" title="gcloud-java">
              <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-lang-java.svg" alt="Java icon" class="menu-icon" />
              Java
            </a>
          </li>
          <li>
            <a href="//googlecloudplatform.github.io/gcloud-node/#/docs" title="gcloud-node">
              <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-lang-nodejs.svg" alt="Node.js icon" class="menu-icon">
              Node.js
            </a>
          </li>
          <li>
            <a href="//googlecloudplatform.github.io/gcloud-python/latest/" title="gcloud-python">
              <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-lang-python.svg" alt="Python icon" class="menu-icon">
              Python
            </a>
          </li>
          <li>
            <a href="//googlecloudplatform.github.io/gcloud-ruby/" title="gcloud-ruby">
              <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-lang-ruby.svg" alt="Ruby icon" class="menu-icon" width="24">
              Ruby
            </a>
          </li>
        </ul>
      </nav>

      <div class="github-issue">
        <a href="https://github.com/GoogleCloudPlatform/gcloud-ruby/issues/new?title=%5BDocumentation+Issue%5D+" target="_blank" class="v-btn">
          <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-link-github.svg" />
          Report an Issue
        </a>
      </div>
    </header>

    <article class="main lang-page" role="main">

      <header class="docs-header">
        <h1 class="page-title">Google::Cloud::Storage</h1>
      </header>

      <section class="content">

        <div id="description" class="description">
          <h1 id="google-cloud-storage">Google Cloud Storage</h1>

<p>Google Cloud Storage is an Internet service to store data in Google’s
cloud. It allows world-wide storage and retrieval of any amount of data
and at any time, taking advantage of Google’s own reliable and fast
networking infrastructure to perform data operations in a cost effective
manner.</p>

<p>The goal of google-cloud is to provide a API that is comfortable to
Rubyists. Authentication is handled by <span class='object_link'><a href="../Cloud.html#storage-instance_method" title="Google::Cloud#storage (method)">#storage</a></span>. You can
provide the project and credential information to connect to the Storage
service, or if you are running on Google Compute Engine this configuration
is taken care of for you.</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"my-todo-project"</span><span class="p">,</span>
                    <span class="s2">"/path/to/keyfile.json"</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-bucket"</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">file</span> <span class="s2">"path/to/my-file.ext"</span>
</code></pre>
</div>

<p>You can learn more about various options for connection on the
<a href="https://googlecloudplatform.github.io/gcloud-ruby/#/docs/guides/authentication">Authentication
Guide</a>.</p>

<p>To learn more about Cloud Storage, read the
<a href="https://cloud.google.com/storage/docs/overview">Google Cloud Storage Overview
</a>.</p>

<h2 id="retrieving-buckets">Retrieving Buckets</h2>

<p>A Bucket is the container for your data. There is no limit on the number
of buckets that you can create in a project. You can use buckets to
organize and control access to your data. Each bucket has a unique name,
which is how they are retrieved: (See
<span class='object_link'><a href="Storage/Project.html#bucket-instance_method" title="Google::Cloud::Storage::Project#bucket (method)">Project#bucket</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
</code></pre>
</div>

<p>You can also retrieve all buckets on a project: (See
<span class='object_link'><a href="Storage/Project.html#buckets-instance_method" title="Google::Cloud::Storage::Project#buckets (method)">Project#buckets</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">all_buckets</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">buckets</span>
</code></pre>
</div>

<p>If you have a significant number of buckets, you may need to paginate
through them: (See <span class='object_link'><a href="Storage/Bucket/List.html#token-instance_method" title="Google::Cloud::Storage::Bucket::List#token (method)">Bucket::List#token</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">all_buckets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">tmp_buckets</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">buckets</span>
<span class="k">while</span> <span class="n">tmp_buckets</span><span class="p">.</span><span class="nf">any?</span> <span class="k">do</span>
  <span class="n">tmp_buckets</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">bucket</span><span class="o">|</span>
    <span class="n">all_buckets</span> <span class="o">&lt;&lt;</span> <span class="n">bucket</span>
  <span class="k">end</span>
  <span class="c1"># break loop if no more buckets available</span>
  <span class="k">break</span> <span class="k">if</span> <span class="n">tmp_buckets</span><span class="p">.</span><span class="nf">token</span><span class="p">.</span><span class="nf">nil?</span>
  <span class="c1"># get the next group of buckets</span>
  <span class="n">tmp_buckets</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">buckets</span> <span class="ss">token: </span><span class="n">tmp_buckets</span><span class="p">.</span><span class="nf">token</span>
<span class="k">end</span>
</code></pre>
</div>

<h2 id="creating-a-bucket">Creating a Bucket</h2>

<p>A unique name is all that is needed to create a new bucket: (See
<span class='object_link'><a href="Storage/Project.html#create_bucket-instance_method" title="Google::Cloud::Storage::Project#create_bucket (method)">Project#create_bucket</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">create_bucket</span> <span class="s2">"my-todo-app-attachments"</span>
</code></pre>
</div>

<h2 id="retrieving-files">Retrieving Files</h2>

<p>A File is an individual pieces of data that you store in Google Cloud
Storage. Files contain the data stored as well as metadata describing the
data. Files belong to a bucket and cannot be shared among buckets. There
is no limit on the number of objects that you can create in a bucket.</p>

<p>Files are retrieved by their name, which is the path of the file in the
bucket: (See <span class='object_link'><a href="Storage/Bucket.html#file-instance_method" title="Google::Cloud::Storage::Bucket#file (method)">Bucket#file</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">file</span> <span class="s2">"avatars/heidi/400x400.png"</span>
</code></pre>
</div>

<p>You can also retrieve all files in a bucket: (See Bucket#files)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">all_files</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">files</span>
</code></pre>
</div>

<p>Or you can retrieve all files in a specified path:</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">avatar_files</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">files</span> <span class="ss">prefix: </span><span class="s2">"avatars/"</span>
</code></pre>
</div>

<p>If you have a significant number of files, you may need to paginate
through them: (See <span class='object_link'><a href="Storage/File/List.html#token-instance_method" title="Google::Cloud::Storage::File::List#token (method)">File::List#token</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>

<span class="n">all_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">tmp_files</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">files</span>
<span class="k">while</span> <span class="n">tmp_files</span><span class="p">.</span><span class="nf">any?</span> <span class="k">do</span>
  <span class="n">tmp_files</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">all_files</span> <span class="o">&lt;&lt;</span> <span class="n">file</span>
  <span class="k">end</span>
  <span class="c1"># break loop if no more files available</span>
  <span class="k">break</span> <span class="k">if</span> <span class="n">tmp_files</span><span class="p">.</span><span class="nf">token</span><span class="p">.</span><span class="nf">nil?</span>
  <span class="c1"># get the next group of files</span>
  <span class="n">tmp_files</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">files</span> <span class="ss">token: </span><span class="n">tmp_files</span><span class="p">.</span><span class="nf">token</span>
<span class="k">end</span>
</code></pre>
</div>

<h2 id="creating-a-file">Creating a File</h2>

<p>A new File can be uploaded by specifying the location of a file on the
local file system, and the name/path that the file should be stored in the
bucket. (See <span class='object_link'><a href="Storage/Bucket.html#create_file-instance_method" title="Google::Cloud::Storage::Bucket#create_file (method)">Bucket#create_file</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">create_file</span> <span class="s2">"/var/todo-app/avatars/heidi/400x400.png"</span><span class="p">,</span>
                   <span class="s2">"avatars/heidi/400x400.png"</span>
</code></pre>
</div>

<h3 id="customer-supplied-encryption-keys">Customer-supplied encryption keys</h3>

<p>By default, Google Cloud Storage manages server-side encryption keys on
your behalf. However, a <a href="https://cloud.google.com/storage/docs/encryption#customer-supplied">customer-supplied encryption
key</a>
can be provided with the <code class="highlighter-rouge">encryption_key</code> and <code class="highlighter-rouge">encryption_key_sha256</code>
options. If given, the same key and SHA256 hash also must be provided to
subsequently download or copy the file. If you use customer-supplied
encryption keys, you must securely manage your keys and ensure that they
are not lost. Also, please note that file metadata is not encrypted, with
the exception of the CRC32C checksum and MD5 hash. The names of files and
buckets are also not encrypted, and you can read or update the metadata of
an encrypted file without providing the encryption key.</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>
<span class="nb">require</span> <span class="s2">"digest/sha2"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>

<span class="c1"># Key generation shown for example purposes only. Write your own.</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Cipher</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"aes-256-cfb"</span>
<span class="n">cipher</span><span class="p">.</span><span class="nf">encrypt</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">random_key</span>
<span class="n">key_hash</span> <span class="o">=</span> <span class="no">Digest</span><span class="o">::</span><span class="no">SHA256</span><span class="p">.</span><span class="nf">digest</span> <span class="n">key</span>

<span class="n">bucket</span><span class="p">.</span><span class="nf">create_file</span> <span class="s2">"/var/todo-app/avatars/heidi/400x400.png"</span><span class="p">,</span>
                   <span class="s2">"avatars/heidi/400x400.png"</span><span class="p">,</span>
                   <span class="ss">encryption_key: </span><span class="n">key</span><span class="p">,</span>
                   <span class="ss">encryption_key_sha256: </span><span class="n">key_hash</span>

<span class="c1"># Store your key and hash securely for later use.</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">file</span> <span class="s2">"avatars/heidi/400x400.png"</span><span class="p">,</span>
                   <span class="ss">encryption_key: </span><span class="n">key</span><span class="p">,</span>
                   <span class="ss">encryption_key_sha256: </span><span class="n">key_hash</span>
</code></pre>
</div>

<h2 id="downloading-a-file">Downloading a File</h2>

<p>Files can be downloaded to the local file system. (See
<span class='object_link'><a href="Storage/File.html#download-instance_method" title="Google::Cloud::Storage::File#download (method)">File#download</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">file</span> <span class="s2">"avatars/heidi/400x400.png"</span>
<span class="n">file</span><span class="p">.</span><span class="nf">download</span> <span class="s2">"/var/todo-app/avatars/heidi/400x400.png"</span>
</code></pre>
</div>

<h2 id="using-signed-urls">Using Signed URLs</h2>

<p>Access without authentication can be granted to a File for a specified
period of time. This URL uses a cryptographic signature of your
credentials to access the file. (See
<span class='object_link'><a href="Storage/File.html#signed_url-instance_method" title="Google::Cloud::Storage::File#signed_url (method)">File#signed_url</a></span>)</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">file</span> <span class="s2">"avatars/heidi/400x400.png"</span>
<span class="n">shared_url</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">signed_url</span> <span class="ss">method: </span><span class="s2">"GET"</span><span class="p">,</span>
                             <span class="ss">expires: </span><span class="mi">300</span> <span class="c1"># 5 minutes from now</span>
</code></pre>
</div>

<h2 id="controlling-access-to-a-bucket">Controlling Access to a Bucket</h2>

<p>Access to a bucket is controlled with
<span class='object_link'><a href="Storage/Bucket.html#acl-instance_method" title="Google::Cloud::Storage::Bucket#acl (method)">Bucket#acl</a></span>. A bucket has owners, writers, and
readers. Permissions can be granted to an individual user’s email address,
a group’s email address, as well as many predefined lists. See the <a href="https://cloud.google.com/storage/docs/access-control">Access
Control guide</a> for
more.</p>

<p>Access to a bucket can be granted to a user by appending <code class="highlighter-rouge">"user-"</code> to the
email address:</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>

<span class="n">email</span> <span class="o">=</span> <span class="s2">"heidi@example.net"</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">acl</span><span class="p">.</span><span class="nf">add_reader</span> <span class="s2">"user-</span><span class="si">#{</span><span class="n">email</span><span class="si">}</span><span class="s2">"</span>
</code></pre>
</div>

<p>Access to a bucket can be granted to a group by appending <code class="highlighter-rouge">"group-"</code> to
the email address:</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>

<span class="n">email</span> <span class="o">=</span> <span class="s2">"authors@example.net"</span>
<span class="n">bucket</span><span class="p">.</span><span class="nf">acl</span><span class="p">.</span><span class="nf">add_reader</span> <span class="s2">"group-</span><span class="si">#{</span><span class="n">email</span><span class="si">}</span><span class="s2">"</span>
</code></pre>
</div>

<p>Access to a bucket can also be granted to a predefined list of
permissions:</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>

<span class="n">bucket</span><span class="p">.</span><span class="nf">acl</span><span class="p">.</span><span class="nf">public!</span>
</code></pre>
</div>

<h2 id="controlling-access-to-a-file">Controlling Access to a File</h2>

<p>Access to a file is controlled in two ways, either by the setting the
default permissions to all files in a bucket with
<span class='object_link'><a href="Storage/Bucket.html#default_acl-instance_method" title="Google::Cloud::Storage::Bucket#default_acl (method)">Bucket#default_acl</a></span>, or by setting permissions to
an individual file with <span class='object_link'><a href="Storage/File.html#acl-instance_method" title="Google::Cloud::Storage::File#acl (method)">File#acl</a></span>.</p>

<p>Access to a file can be granted to a user by appending <code class="highlighter-rouge">"user-"</code> to the
email address:</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">file</span> <span class="s2">"avatars/heidi/400x400.png"</span>

<span class="n">email</span> <span class="o">=</span> <span class="s2">"heidi@example.net"</span>
<span class="n">file</span><span class="p">.</span><span class="nf">acl</span><span class="p">.</span><span class="nf">add_reader</span> <span class="s2">"user-</span><span class="si">#{</span><span class="n">email</span><span class="si">}</span><span class="s2">"</span>
</code></pre>
</div>

<p>Access to a file can be granted to a group by appending <code class="highlighter-rouge">"group-"</code> to the
email address:</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">file</span> <span class="s2">"avatars/heidi/400x400.png"</span>

<span class="n">email</span> <span class="o">=</span> <span class="s2">"authors@example.net"</span>
<span class="n">file</span><span class="p">.</span><span class="nf">acl</span><span class="p">.</span><span class="nf">add_reader</span> <span class="s2">"group-</span><span class="si">#{</span><span class="n">email</span><span class="si">}</span><span class="s2">"</span>
</code></pre>
</div>

<p>Access to a file can also be granted to a predefined list of permissions:</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="n">storage</span><span class="p">.</span><span class="nf">bucket</span> <span class="s2">"my-todo-app"</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">bucket</span><span class="p">.</span><span class="nf">file</span> <span class="s2">"avatars/heidi/400x400.png"</span>

<span class="n">file</span><span class="p">.</span><span class="nf">acl</span><span class="p">.</span><span class="nf">public!</span>
</code></pre>
</div>

<h2 id="configuring-retries-and-timeout">Configuring retries and timeout</h2>

<p>You can configure how many times API requests may be automatically
retried. When an API request fails, the response will be inspected to see
if the request meets criteria indicating that it may succeed on retry,
such as <code class="highlighter-rouge">500</code> and <code class="highlighter-rouge">503</code> status codes or a specific internal error code
such as <code class="highlighter-rouge">rateLimitExceeded</code>. If it meets the criteria, the request will be
retried after a delay. If another error occurs, the delay will be
increased before a subsequent attempt, until the <code class="highlighter-rouge">retries</code> limit is
reached.</p>

<p>You can also set the request <code class="highlighter-rouge">timeout</code> value in seconds.</p>

<div class="language-ruby highlighter-rouge"><pre class="ruby"><code><span class="nb">require</span> <span class="s2">"google/cloud"</span>

<span class="n">gcloud</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="p">.</span><span class="nf">new</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">gcloud</span><span class="p">.</span><span class="nf">storage</span> <span class="ss">retries: </span><span class="mi">10</span><span class="p">,</span> <span class="ss">timeout: </span><span class="mi">120</span>
</code></pre>
</div>

<p>See the <a href="https://cloud.google.com/storage/docs/json_api/v1/status-codes">Storage status and error
codes</a>
for a list of error conditions.</p>

        </div>

        <div class="section-links">
          

          
          

          
        </div>

        
      </section>

      <nav class="side-nav">

        <div class="side-nav--meta"><div id="doc-build-date">Docs built on Aug 01, 2016.</div></div><ul><h4 class="list-item--heading">Getting Started</h4><li class='toc-l0'><a class='reference internal' href='../../index.html'>Overview</a></li><li class='toc-l0'><a class='reference internal' href='../../AUTHENTICATION.html'>Authentication Guide</a></li></ul><ul><h4 class="list-item--heading">API</h4><li class='toc-l0'><a class='reference internal' href='../../reference.html'>API Reference</a></li></ul>

        <ul class="external-links">
          <li>
            <a href="https://github.com/GoogleCloudPlatform/gcloud-ruby" title="Github repository">
              <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-link-github.svg" alt="Github icon">
              Github
            </a>
          </li>
          <li>
            <a href="https://github.com/GoogleCloudPlatform/gcloud-ruby/issues" title="Issues on Github">
              <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-link-issues.svg" alt="Issues icon">
              Issues
            </a>
          </li>
          <li>
            <a href="http://stackoverflow.com/questions/tagged/gcloud-ruby" title="gcloud on StackOverflow">
              <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon">
              StackOverflow
            </a>
          </li>
          <li>
            <a href="http://rubygems.org/gems/gcloud" title="RubyGems" class="ext-link">
               <img src="//googlecloudplatform.github.io/gcloud-ruby/img/icon-link-rubygems.svg" alt="RubyGems icon">
              RubyGems
            </a>
          </li>
        </ul>

      </nav>

    </article>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script ="//googlecloudplatform.github.io/gcloud-ruby/js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
    <script src="//googlecloudplatform.github.io/gcloud-ruby/js/plugins.js"></script>
    <script src="//googlecloudplatform.github.io/gcloud-ruby/js/main.js"></script>

    <script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create','UA-49880327-13');ga('send','pageview');
    </script>

  </body>
</html>
